<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Platformer 5100+ уровней с супер-скинами</title>
<style>
body { margin:0; font-family:sans-serif; overflow:hidden; }
canvas { display:block; margin:0 auto; }
#ui { position:absolute; top:10px; left:10px; z-index:10; font-size:16px; }
button { font-size:16px; margin-right:5px; }
#shop, #levelSelect, #settings { display:none; position:absolute; top:50px; left:50px; background:white; border:2px solid black; padding:10px; max-height:400px; overflow:auto; z-index:20;}
</style>
</head>
<body>
<div id="ui">
<div id="score">Очки: 0</div>
<div id="level">Уровень: 1</div>
<div id="skin">Скин: 1</div>
<button id="shopBtn">Магазин</button>
<button id="levelBtn">Выбрать уровень</button>
<button id="settingsBtn">Настройки</button>
</div>
<div id="shop"></div>
<div id="levelSelect"></div>
<div id="settings">
<b>Настройки графики</b><br>
<button onclick="setGraphics('low')">Слабая</button>
<button onclick="setGraphics('medium')">Средняя</button>
<button onclick="setGraphics('high')">Высокая</button>
</div>
<canvas id="gameCanvas" width="800" height="400"></canvas>

<script>
const canvas=document.getElementById('gameCanvas');
const ctx=canvas.getContext('2d');
let score=0, level=0, completedLevels=[], graphics='high';
const player={x:50,y:300,radius:30,dx:0,dy:0,speed:5,jumpPower:12,onGround:false,direction:'right',skin:0};

const skins=[];
for(let i=0;i<500;i++){
    skins.push({color:`hsl(${i*0.7},80%,50%)`,name:'Скин '+(i+1),blinkTimer:Math.random()*2000+1000,price:i<100?50:100,jumpBounce:Math.random()*0.3+0.1,headNodSpeed:Math.random()*0.05+0.02,rare:false});
}
for(let i=0;i<50;i++){
    skins.push({color:`hsl(${i*7},90%,50%)`,name:'Супер Скин '+(i+1),blinkTimer:Math.random()*1500+500,price:1000,jumpBounce:Math.random()*0.5+0.2,headNodSpeed:Math.random()*0.1+0.05,rare:true});
}
let ownedSkins=[0], unlockedSuperSkins=[];

function setGraphics(level){graphics=level; alert('Графика установлена: '+level);}

const locations=[{name:'Лес',bg:'#88cc88',platColor:'#228B22',enemyColor:'brown'},{name:'Пустыня',bg:'#f4e5b0',platColor:'#c2b280',enemyColor:'orange'},{name:'Снег',bg:'#cce6ff',platColor:'#99ccff',enemyColor:'blue'},{name:'Лава',bg:'#ff9966',platColor:'#cc3300',enemyColor:'red'},{name:'Космос',bg:'#000011',platColor:'#4444ff',enemyColor:'#ff44ff'}];
const bonusLocations=[{name:'Затерянный храм',bg:'#eedc82',platColor:'#a0522d',enemyColor:'#663300'},{name:'Подводный мир',bg:'#66ccff',platColor:'#3399cc',enemyColor:'#003366'},{name:'Небесный остров',bg:'#ccf2ff',platColor:'#99d6ff',enemyColor:'#6666ff'}];

const gravity=0.5;
function generateLevels(num){
    const levels=[];
    for(let i=0;i<num;i++){
        const diff=1+i/1500;
        const platCount=Math.min(3+Math.floor(Math.random()*5)+Math.floor(diff*2),12);
        const platforms=[]; for(let j=0;j<platCount;j++){platforms.push({x:Math.random()*(canvas.width-100),y:100+Math.random()*250,width:Math.max(50,150-diff*10),height:20});}
        platforms.push({x:0,y:360,width:800,height:40});
        const coins=[]; for(let k=0;k<1+Math.floor(Math.random()*3+diff/2);k++){coins.push({x:Math.random()*(canvas.width-20)+10,y:150+Math.random()*200,radius:8,collected:false});}
        const enemies=[]; for(let e=0;e<Math.floor(Math.random()*3+diff/2);e++){enemies.push({x:Math.random()*(canvas.width-40),y:150+Math.random()*200,width:40,height:40,dx:2+Math.random()*3+diff/3});}
        let boss=null; if((i+1)%100===0){boss={x:400,y:250,width:80,height:80,dx:2+diff*0.5,dy:0,shootTimer:0,bullets:[],type:'normal'};}
        let loc=null, bonus=false;
        if((i+1)%250===0){loc=bonusLocations[Math.floor(Math.random()*bonusLocations.length)];bonus=true;boss={x:400,y:250,width:80,height:80,dx:2,dy:0,shootTimer:0,bullets:[],type:'bonus'};}
        else loc=locations[i%locations.length];
        levels.push({platforms,coins,enemies,boss,location:loc,bonus});
    }
    return levels;
}
const levels=generateLevels(5100);
let currentLevel=levels[level];
const keys={};
document.addEventListener('keydown',e=>keys[e.key]=true);
document.addEventListener('keyup',e=>keys[e.key]=false);

const shopDiv=document.getElementById('shop'); const levelSelectDiv=document.getElementById('levelSelect');
document.getElementById('shopBtn').onclick=()=>{shopDiv.style.display=shopDiv.style.display==='none'?'block':'none'; updateShop();};
document.getElementById('levelBtn').onclick=()=>{levelSelectDiv.style.display=levelSelectDiv.style.display==='none'?'block':'none'; updateLevelSelect();};
document.getElementById('settingsBtn').onclick=()=>{document.getElementById('settings').style.display=document.getElementById('settings').style.display==='none'?'block':'none';};

function updateShop(){shopDiv.innerHTML='<b>Магазин (очков: '+score+')</b><br>';for(let i=0;i<skins.length;i++){const owned=ownedSkins.includes(i);let buyText=skins[i].rare?'[Редкий — бонусная локация]':owned?'[Куплен]':'<button onclick="buySkin('+i+')">Купить '+skins[i].price+' очков</button>';shopDiv.innerHTML+=`<div style="margin-bottom:5px;"><span style="display:inline-block;width:20px;height:20px;background:${skins[i].color};"></span>${skins[i].name} ${buyText}<button onclick="equipSkin(${i})">Надеть</button></div>`;}}
function buySkin(id){if(score>=skins[id].price&&!ownedSkins.includes(id)&&!skins[id].rare){score-=skins[id].price;ownedSkins.push(id);document.getElementById('score').innerText='Очки: '+score;shopDiv.style.display='none';}else alert('Недостаточно очков, скин уже куплен или редкий');}
function equipSkin(id){if(ownedSkins.includes(id)){player.skin=id;document.getElementById('skin').innerText='Скин: '+(id+1);}else alert('Скин не куплен');}
function updateLevelSelect(){if(completedLevels.length===0){alert('Нет пройденных уровней'); return;}levelSelectDiv.innerHTML='<b>Выбор уровня</b><br>';for(let lvl of completedLevels){levelSelectDiv.innerHTML+=`<button onclick="goToLevel(${lvl})">Уровень ${lvl+1}</button> `;}}

function goToLevel(lvl){level=lvl;currentLevel=levels[level];resetLevel();document.getElementById('level').innerText='Уровень: '+(level+1);levelSelectDiv.style.display='none';}
function resetLevel(){player.x=50;player.y=300;player.dx=0;player.dy=0;for(let coin of currentLevel.coins) coin.collected=false;}
function nextLevel(){if(!completedLevels.includes(level)) completedLevels.push(level);if(currentLevel.bonus){const rareSkins=skins.map((s,i)=>s.rare && !ownedSkins.includes(i)?i:null).filter(x=>x!==null);if(rareSkins.length>0 && Math.random()<0.5){const got=rareSkins[Math.floor(Math.random()*rareSkins.length)];ownedSkins.push(got);unlockedSuperSkins.push(got);alert('Поздравляем! Вы получили редкий супер-скин: '+skins[got].name);}}level++;player.speed+=0.2;if(level>=levels.length){alert('Все уровни пройдены!');level=0;score=0;player.speed=5;}currentLevel=levels[level];document.getElementById('level').innerText='Уровень: '+(level+1);resetLevel();}

let headNodPhase=0;
function update(){
    if(keys['ArrowLeft']){player.dx=-player.speed; player.direction='left';}
    else if(keys['ArrowRight']){player.dx=player.speed; player.direction='right';}
    else player.dx=0;
    if(keys['ArrowUp'] && player.onGround){player.dy=-player.jumpPower; player.onGround=false;}
    player.dy+=gravity; player.x+=player.dx; player.y+=player.dy;
    player.onGround=false;
    for(let plat of currentLevel.platforms){if(player.x-player.radius<plat.x+plat.width && player.x+player.radius>plat.x && player.y+player.radius>plat.y && player.y-player.radius<plat.y+plat.height){if(player.dy>0 && player.y+player.radius-player.dy<=plat.y){player.y=plat.y-player.radius; player.dy=0; player.onGround=true;}}}
    if(player.x-player.radius<0) player.x=player.radius;if(player.x+player.radius>canvas.width) player.x=canvas.width-player.radius;if(player.y-player.radius>canvas.height) resetLevel();
    for(let coin of currentLevel.coins){if(!coin.collected){const dx=player.x-coin.x, dy=player.y-coin.y;if(Math.sqrt(dx*dx+dy*dy)<player.radius+coin.radius){coin.collected=true;score+=10;document.getElementById('score').innerText='Очки: '+score;}}}
    if(currentLevel.coins.every(c=>c.collected)) nextLevel();
    draw(); requestAnimationFrame(update);
}

function draw(){
    ctx.fillStyle=currentLevel.location.bg; ctx.fillRect(0,0,canvas.width,canvas.height);
    const skin=skins[player.skin]; const time=Date.now();
    const bounce=player.onGround?0:Math.sin(time*0.01)*skin.jumpBounce*20;
    if(player.dx!==0) headNodPhase+=skin.headNodSpeed*player.dx;
    const nodOffset=Math.sin(headNodPhase)*5;
    ctx.fillStyle=skin.color;
    ctx.beginPath(); ctx.arc(player.x,player.y+bounce+nodOffset,player.radius,0,Math.PI*2); ctx.fill(); ctx.closePath();

    let blink=((time%skin.blinkTimer)>skin.blinkTimer-200)?0:4;
    if(graphics==='low'){blink=2;} else if(graphics==='medium'){blink=3;}
    ctx.fillStyle='black';
    ctx.beginPath();
    ctx.arc(player.x-10,player.y-10+bounce+nodOffset,blink,0,Math.PI*2);
    ctx.arc(player.x+10,player.y-10+bounce+nodOffset,blink,0,Math.PI*2);
    ctx.fill(); ctx.closePath();

    let mouthCurvature=player.onGround?1:-1;
    if(skin.rare){mouthCurvature*=2*Math.sin(time*0.05);}
    ctx.save(); ctx.translate(player.x,player.y+5+bounce+nodOffset); ctx.scale(1,mouthCurvature);
    ctx.beginPath(); ctx.arc(0,0,10,0,Math.PI); ctx.stroke(); ctx.restore();

    ctx.fillStyle=currentLevel.location.platColor;
    for(let plat of currentLevel.platforms) ctx.fillRect(plat.x,plat.y,plat.width,plat.height);
    ctx.fillStyle='yellow';
    for(let coin of currentLevel.coins){if(!coin.collected)ctx.beginPath(),ctx.arc(coin.x,coin.y,coin.radius,0,Math.PI*2),ctx.fill(),ctx.closePath();}

    // Динамическое сияние супер-скинов
    if(skin.rare && graphics!=='low'){
        const speedFactor = Math.min(Math.abs(player.dx)/player.speed,1);
        const glowRadius = player.radius + 5 + Math.sin(Date.now()*0.02)*(5 + speedFactor*10);
        const alpha = 0.3 + speedFactor*0.7;
        ctx.strokeStyle=`rgba(255,255,0,${alpha})`;
        ctx.lineWidth = 3 + speedFactor*2;
        ctx.beginPath();
        ctx.arc(player.x,player.y+bounce+nodOffset,glowRadius,0,Math.PI*2);
        ctx.stroke();
        ctx.closePath();
    }
}

update();
</script>
</body>
</html>
